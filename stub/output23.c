/************************************************************************
 * WARNING: DO NOT EDIT THIS FILE.  THIS FILE WAS AUTOMATICALLY GENERATED
 * ANY CHANGES MADE TO THIS FILE WILL BE LOST
 *
 * File translated:      ../alpha-emulator/ihalt.as
 ************************************************************************/

  /* This file implements the out-of-line parts of the instruction dispatch loop. */
/* start iOutOfLine */


ioutofline:
  if (_trace) printf("ioutofline:\n");

traporsuspendmachine:
  if (_trace) printf("traporsuspendmachine:\n");
  t4 = *(s32 *)&processor->control;   
  *(u64 *)&processor->restartsp = iSP;   		// Be sure this is up-to-date 
  r0 = *(u64 *)&(processor->please_stop); /* lock */     		// Has the spy asked us to stop or trap? 
  t5 = zero;
  *(u64 *)&processor->please_stop = t5; /* lock */   
  t5 = 1;
  if (t5 == 0) 
    goto collision;
  *(u64 *)&processor->stop_interpreter = zero;   

collision:
  t3 = CMPBGE(r0, HaltReason_IllInstn);  		// t3<0>=1 if we've been asked to stop 
  if (t3 & 1)   
    goto SUSPENDMACHINE;
  /* Here when someone wants the emulator to trap. */
  r0 = (u32)(r0 >> ((4&7)*8));   		// Extract PROCESSORSTATE_PLEASE_TRAP (ivory) 
  t4 = t4 >> 30;   		// Isolate current trap mode 
  t3 = (r0 == TrapReason_HighPrioritySequenceBreak) ? 1 : 0;   

force-alignment11406:
  if (_trace) printf("force-alignment11406:\n");
  if (t3 == 0) 
    goto basic-dispatch11402;
  /* Here if argument TrapReasonHighPrioritySequenceBreak */
  t4 = ((u64)t4 <= (u64)TrapMode_ExtraStack) ? 1 : 0;   		// Only interrupts EXTRA-STACK and EMULATOR 
  if (t4 == 0) 
    goto continuecurrentinstruction;
  goto highprioritysequencebreak;

basic-dispatch11402:
  if (_trace) printf("basic-dispatch11402:\n");
  t3 = (r0 == TrapReason_LowPrioritySequenceBreak) ? 1 : 0;   

force-alignment11407:
  if (_trace) printf("force-alignment11407:\n");
  if (t3 == 0) 
    goto basic-dispatch11403;
  /* Here if argument TrapReasonLowPrioritySequenceBreak */
  if (t4 != 0)   		// Only interrupts EMULATOR 
    goto continuecurrentinstruction;
  goto lowprioritysequencebreak;

basic-dispatch11403:
  if (_trace) printf("basic-dispatch11403:\n");
  /* Here for all other cases */
  /* Check for preempt-request trap */
  t5 = *(s32 *)&processor->interruptreg;   		// Get the preempt-pending bit 
  if (t4 != 0)   		// Don't take preempt trap unless in emulator mode 
    goto continuecurrentinstruction;
  if ((t5 & 1) == 0)   		// Jump if preempt request not pending 
    goto continuecurrentinstruction;
  goto preemptrequesttrap;

basic-dispatch11401:
  if (_trace) printf("basic-dispatch11401:\n");

SUSPENDMACHINE:
  if (_trace) printf("SUSPENDMACHINE:\n");
  t1 = (u32)r0;   		// Get the reason 
  goto stopinterp;   

ILLEGALINSTRUCTION:
  if (_trace) printf("ILLEGALINSTRUCTION:\n");
  t1 = HaltReason_IllInstn;
  goto stopinterp;   

haltmachine:
  if (_trace) printf("haltmachine:\n");
  t1 = HaltReason_Halted;
  goto stopinterp;   

fatalstackoverflow:
  if (_trace) printf("fatalstackoverflow:\n");
  t1 = HaltReason_FatalStackOverflow;
  goto stopinterp;   

illegaltrapvector:
  if (_trace) printf("illegaltrapvector:\n");
  t1 = HaltReason_IllegalTrapVector;
  goto stopinterp;   

stopinterp:
  if (_trace) printf("stopinterp:\n");
  r0 = t1;		// Return the halt reason 
		/* Clear the request flag */
  *(u32 *)&processor->please_stop = zero;
  *(u64 *)&processor->cp = iCP;   
  *(u64 *)&processor->epc = iPC;   
  *(u64 *)&processor->sp = iSP;   
  *(u64 *)&processor->fp = iFP;   
  *(u64 *)&processor->lp = iLP;   
  *(u64 *)&processor->runningp = zero;   		// Stop the (emulated) chip 
  r9 = *(u64 *)&(processor->asrr9);   
  r10 = *(u64 *)&(processor->asrr10);   
  r11 = *(u64 *)&(processor->asrr11);   
  r12 = *(u64 *)&(processor->asrr12);   
  r13 = *(u64 *)&(processor->asrr13);   
  r15 = *(u64 *)&(processor->asrr15);   
  r26 = *(u64 *)&(processor->asrr26);   
  r27 = *(u64 *)&(processor->asrr27);   
  r29 = *(u64 *)&(processor->asrr29);   
  r30 = *(u64 *)&(processor->asrr30);   
  r14 = *(u64 *)&(processor->asrr14);   
  goto *ra; /* ret */

/* end iOutOfLine */



/* End of file automatically generated from ../alpha-emulator/ihalt.as */
