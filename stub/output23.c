/************************************************************************
 * WARNING: DO NOT EDIT THIS FILE.  THIS FILE WAS AUTOMATICALLY GENERATED
 * ANY CHANGES MADE TO THIS FILE WILL BE LOST
 *
 * File translated:      ../alpha-emulator/ihalt.as
 ************************************************************************/

/* This file implements the out-of-line parts of the instruction dispatch loop. */
/* start iOutOfLine */

ioutofline : if (_trace) printf("ioutofline:\n");

traporsuspendmachine : if (_trace) printf("traporsuspendmachine:\n");
t4 = *(int32_t *)&processor->control;
*(uint64_t *)&processor->restartsp = iSP; // Be sure this is up-to-date
r0 = *(uint64_t *)&(processor->please_stop); /* lock */ // Has the spy asked us to stop or trap?
t5 = zero;
*(uint64_t *)&processor->please_stop = t5; /* lock */
t5 = 1;
if (t5 == 0)
    goto collision;
*(uint64_t *)&processor->stop_interpreter = zero;

collision : t3 = CMPBGE(r0, HaltReason_IllInstn); // t3<0>=1 if we've been asked to stop
if (t3 & 1)
    goto SUSPENDMACHINE;
/* Here when someone wants the emulator to trap. */
r0 = (uint32_t) (r0 >> ((4 & 7) * 8)); // Extract PROCESSORSTATE_PLEASE_TRAP (ivory)
t4 = t4 >> 30; // Isolate current trap mode
t3 = (r0 == TrapReason_HighPrioritySequenceBreak) ? 1 : 0;

force_alignment46437 : if (_trace) printf("force_alignment46437:\n");
if (t3 == 0)
    goto basic_dispatch46433;
/* Here if argument TrapReasonHighPrioritySequenceBreak */
t4 = ((uint64_t) t4 <= (uint64_t) TrapMode_ExtraStack) ? 1 : 0; // Only interrupts EXTRA-STACK and EMULATOR
if (t4 == 0)
    goto continuecurrentinstruction;
goto highprioritysequencebreak;

basic_dispatch46433 : if (_trace) printf("basic_dispatch46433:\n");
t3 = (r0 == TrapReason_LowPrioritySequenceBreak) ? 1 : 0;

force_alignment46438 : if (_trace) printf("force_alignment46438:\n");
if (t3 == 0)
    goto basic_dispatch46434;
/* Here if argument TrapReasonLowPrioritySequenceBreak */
if (t4 != 0) // Only interrupts EMULATOR
    goto continuecurrentinstruction;
goto lowprioritysequencebreak;

basic_dispatch46434 : if (_trace) printf("basic_dispatch46434:\n");
/* Here for all other cases */
/* Check for preempt-request trap */
t5 = *(int32_t *)&processor->interruptreg; // Get the preempt-pending bit
if (t4 != 0) // Don't take preempt trap unless in emulator mode
    goto continuecurrentinstruction;
if ((t5 & 1) == 0) // Jump if preempt request not pending
    goto continuecurrentinstruction;
goto preemptrequesttrap;

basic_dispatch46432 : if (_trace) printf("basic_dispatch46432:\n");

SUSPENDMACHINE : if (_trace) printf("SUSPENDMACHINE:\n");
t1 = (uint32_t) r0; // Get the reason
goto stopinterp;

ILLEGALINSTRUCTION : if (_trace) printf("ILLEGALINSTRUCTION:\n");
t1 = HaltReason_IllInstn;
goto stopinterp;

haltmachine : if (_trace) printf("haltmachine:\n");
t1 = HaltReason_Halted;
goto stopinterp;

fatalstackoverflow : if (_trace) printf("fatalstackoverflow:\n");
t1 = HaltReason_FatalStackOverflow;
goto stopinterp;

illegaltrapvector : if (_trace) printf("illegaltrapvector:\n");
t1 = HaltReason_IllegalTrapVector;
goto stopinterp;

stopinterp : if (_trace) printf("stopinterp:\n");
r0 = t1; // Return the halt reason
*(uint32_t *)&processor->please_stop = zero; // Clear the request flag
*(uint64_t *)&processor->cp = iCP;
*(uint64_t *)&processor->epc = iPC;
*(uint64_t *)&processor->sp = iSP;
*(uint64_t *)&processor->fp = iFP;
*(uint64_t *)&processor->lp = iLP;
*(uint64_t *)&processor->runningp = zero; // Stop the (emulated) chip
r9 = *(uint64_t *)&(processor->asrr9);
r10 = *(uint64_t *)&(processor->asrr10);
r11 = *(uint64_t *)&(processor->asrr11);
r12 = *(uint64_t *)&(processor->asrr12);
r13 = *(uint64_t *)&(processor->asrr13);
r15 = *(uint64_t *)&(processor->asrr15);
r26 = *(uint64_t *)&(processor->asrr26);
r27 = *(uint64_t *)&(processor->asrr27);
r29 = *(uint64_t *)&(processor->asrr29);
r30 = *(uint64_t *)&(processor->asrr30);
r14 = *(uint64_t *)&(processor->asrr14);
goto *ra; /* ret */

/* end iOutOfLine */

/* End of file automatically generated from ../alpha-emulator/ihalt.as */
